<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digifea | Lead Intelligence Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #b2dfdb; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Static SVG Map for Lucide Icons to avoid CDN destructuring issues
        const ICON_MAP = {
            History: <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8m0 0V3m0 5h5M12 7v5l4 2" />,
            Settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" />,
            Search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
            Loader2: <path d="M21 12a9 9 0 1 1-6.219-8.56" />,
            Building2: <><path d="M6 22V4c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v18" /><path d="M6 18H4c-.6 0-1-.4-1-1v-5c0-.6.4-1 1-1h2" /><path d="M18 18h2c.6 0 1-.4 1-1v-5c0-.6.4-1 1-1h-2" /><path d="M10 8h4" /><path d="M10 12h4" /><path d="M10 16h4" /></>,
            Phone: <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />,
            MapPin: <><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></>,
            Globe: <><circle cx="12" cy="12" r="10" /><path d="M12 2a14.5 14.5 0 0 0 0 20" /><path d="M2 12h20" /></>,
            Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
            TrendingUp: <path d="m22 7-8.5 8.5-5-5L2 17" />,
            Zap: <path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z" />,
            Trash2: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
            X: <path d="M18 6 6 18M6 6l12 12" />,
            AlertCircle: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>
        };

        const Icon = ({ name, size = 16, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {ICON_MAP[name] || null}
            </svg>
        );

        const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";
        const SYSTEM_PROMPT = `You are a Medical Data Extraction Bot. Output STRICT JSON ONLY: { "clinic_name": "Name", "phone": "Phone", "email": "Email", "address": "Address", "hours": "Hours", "structure": "Structure", "practitioners": "Count", "primary_payers": ["List"], "ehr_pms": "Software", "average_ar": "AR Days", "feasibility": "High/Medium/Low", "right_person": "Name", "office_mgr": "Name", "vibe": "Summary", "hook": "Question" }`;

        const App = () => {
            const [apiKey, setApiKey] = useState("");
            const [showSettings, setShowSettings] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [input, setInput] = useState('');
            const [historySearch, setHistorySearch] = useState('');
            const [loading, setLoading] = useState(false);
            const [leadData, setLeadData] = useState(null);
            const [error, setError] = useState(null);
            const [history, setHistory] = useState([]);

            useEffect(() => {
                const savedHistory = localStorage.getItem('digifea_history');
                const savedKey = localStorage.getItem('digifea_api_key');
                if (savedHistory) setHistory(JSON.parse(savedHistory));
                if (savedKey) setApiKey(savedKey);
            }, []);

            useEffect(() => {
                localStorage.setItem('digifea_history', JSON.stringify(history));
                localStorage.setItem('digifea_api_key', apiKey);
            }, [history, apiKey]);

            const verifyLead = async () => {
                if (!input.trim() || !apiKey) {
                    setError(!apiKey ? "Missing API Key in Settings" : "Please enter a search term");
                    return;
                }
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ role: "user", parts: [{ text: `Full lead intelligence for: ${input}` }] }],
                            systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
                            tools: [{ "google_search": {} }]
                        })
                    });
                    const resData = await response.json();
                    if (resData.error) throw new Error(resData.error.message);
                    
                    const text = resData.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) throw new Error("No data returned from AI engine.");
                    
                    const start = text.indexOf('{');
                    const end = text.lastIndexOf('}') + 1;
                    const parsed = JSON.parse(text.substring(start, end));
                    const newLead = { ...parsed, id: Date.now() };
                    setLeadData(newLead);
                    setHistory(prev => [newLead, ...prev]);
                } catch (err) {
                    setError(`Error: ${err.message || "Failed to fetch data."}`);
                } finally {
                    setLoading(false);
                }
            };

            const filteredHistory = history.filter(item => 
                item.clinic_name?.toLowerCase().includes(historySearch.toLowerCase())
            );

            return (
                <div className="min-h-screen flex flex-col relative overflow-x-hidden">
                    <nav className="bg-[#e0f2f1] border-b border-[#b2dfdb] px-4 md:px-8 py-3 flex justify-between items-center sticky top-0 z-[60] shadow-sm">
                        <div className="flex items-center gap-4">
                            <img src="digifea.png" alt="DIGIFEA" className="h-10 md:h-12 w-auto" onError={(e) => e.target.src="https://via.placeholder.com/150x50/e0f2f1/00695c?text=DIGIFEA"} />
                            <div className="hidden md:block h-6 w-[1px] bg-[#b2dfdb]" />
                            <span className="hidden md:block text-[10px] font-black text-[#00695c] uppercase tracking-widest">Lead Intelligence</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setShowHistory(!showHistory)} className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all border ${showHistory ? 'bg-[#00796b] text-white' : 'bg-white text-[#00695c] border-[#b2dfdb]'}`}>
                                <Icon name="History" size={14} /> History ({history.length})
                            </button>
                            <button onClick={() => setShowSettings(true)} className="p-2 bg-white border border-[#b2dfdb] rounded-xl text-[#00695c] hover:bg-[#f5fbfb] transition-colors">
                                <Icon name="Settings" size={18} />
                            </button>
                        </div>
                    </nav>

                    <main className={`flex-1 transition-all duration-300 ${showHistory ? 'md:mr-80' : ''} p-6 pt-12 max-w-6xl mx-auto w-full`}>
                        <div className="bg-white rounded-[2.5rem] p-8 md:p-12 shadow-sm border border-slate-200 mb-10 text-center">
                            <h2 className="text-3xl md:text-4xl font-black text-slate-900 mb-2">Lead <span className="text-[#00796b]">Verification</span> Hub</h2>
                            <p className="text-slate-500 mb-8 text-sm">Grounding live clinical data for smarter outreach.</p>
                            <div className="relative max-w-2xl mx-auto">
                                <input 
                                    className="w-full pl-12 pr-32 md:pr-40 py-5 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-[#00796b] outline-none text-lg font-semibold transition-all shadow-inner focus:bg-white"
                                    placeholder="Search clinic or phone..." 
                                    value={input} onChange={e => setInput(e.target.value)}
                                    onKeyDown={e => e.key === 'Enter' && verifyLead()}
                                />
                                <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"><Icon name="Search" size={20}/></div>
                                <button onClick={verifyLead} className="absolute right-2 top-2 bottom-2 bg-[#00796b] hover:bg-[#00695c] text-white px-6 md:px-8 rounded-xl font-bold text-xs uppercase tracking-widest transition-all active:scale-95 shadow-md">
                                    {loading ? <Icon name="Loader2" className="animate-spin" /> : "Search"}
                                </button>
                            </div>
                        </div>

                        {error && <div className="bg-rose-50 text-rose-700 p-4 rounded-xl mb-6 font-bold text-sm border-l-4 border-rose-500 flex items-center gap-2"><Icon name="AlertCircle" size={16}/> {error}</div>}

                        {leadData && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in">
                                <div className="lg:col-span-2 bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-xl">
                                    <div className="bg-[#263238] p-6 text-white flex justify-between items-center">
                                        <h3 className="font-black uppercase tracking-tight">Intelligence Report</h3>
                                        <Icon name="TrendingUp" className="text-[#00796b]" size={20}/>
                                    </div>
                                    <div className="divide-y divide-slate-50">
                                        {[
                                            {l: "Clinic", v: leadData.clinic_name, i: "Building2"},
                                            {l: "Phone", v: leadData.phone, i: "Phone"},
                                            {l: "Address", v: leadData.address, i: "MapPin"},
                                            {l: "EHR/PMS", v: leadData.ehr_pms, i: "Globe"},
                                            {l: "Feasibility", v: leadData.feasibility, i: "Activity"}
                                        ].map((row, i) => (
                                            <div key={i} className="flex px-8 py-4 items-center hover:bg-slate-50 transition-colors">
                                                <div className="w-1/3 text-[10px] font-black text-slate-400 uppercase flex items-center gap-2">
                                                    <Icon name={row.i} size={12}/> {row.l}
                                                </div>
                                                <div className="w-2/3 font-bold text-slate-800">{row.v || "N/A"}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-[#00796b] p-8 rounded-[2rem] text-white shadow-2xl relative overflow-hidden group">
                                    <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:scale-110 transition-transform"><Icon name="Zap" size={80}/></div>
                                    <h3 className="text-[10px] font-black uppercase mb-6 opacity-60 tracking-widest relative">Opening Hook</h3>
                                    <div className="bg-white text-[#004d40] p-6 rounded-2xl font-bold shadow-lg leading-relaxed relative border-2 border-[#b2dfdb]">
                                        {leadData.hook}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Sidebar */}
                    <aside className={`fixed top-[65px] right-0 bottom-0 w-80 bg-white border-l border-[#b2dfdb] z-50 transition-transform duration-300 ${showHistory ? 'translate-x-0' : 'translate-x-full'} shadow-2xl flex flex-col`}>
                        <div className="p-6 border-b bg-[#f5fbfb] flex justify-between items-center">
                            <h3 className="font-black text-xs uppercase text-[#00695c] flex items-center gap-2">Repository</h3>
                            <button onClick={() => setShowHistory(false)} className="text-slate-400 hover:text-slate-900"><Icon name="X" /></button>
                        </div>
                        <div className="p-4 bg-[#f8fafc]"><input className="w-full p-2 border rounded-lg text-sm bg-white focus:border-[#00796b] outline-none shadow-sm" placeholder="Filter history..." value={historySearch} onChange={e => setHistorySearch(e.target.value)} /></div>
                        <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                            {filteredHistory.length === 0 ? (
                                <div className="text-center py-10 opacity-20"><p className="text-[10px] font-black uppercase text-slate-400">Empty</p></div>
                            ) : (
                                filteredHistory.map(item => (
                                    <div key={item.id} onClick={() => setLeadData(item)} className="p-4 mb-3 bg-white border rounded-xl hover:border-[#00796b] cursor-pointer group relative transition-all hover:shadow-md">
                                        <div className="font-bold text-xs uppercase truncate pr-6 text-slate-800">{item.clinic_name}</div>
                                        <div className="text-[9px] text-slate-400 font-bold uppercase mt-1 flex items-center gap-1"> {item.address?.substring(0, 20)}...</div>
                                        <button onClick={(e) => {e.stopPropagation(); setHistory(h => h.filter(i => i.id !== item.id))}} className="absolute right-3 top-4 opacity-0 group-hover:opacity-100 text-rose-500 hover:scale-110 transition-all"><Icon name="Trash2" size={14}/></button>
                                    </div>
                                ))
                            )}
                        </div>
                    </aside>

                    {/* Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/40 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
                            <div className="bg-white rounded-[2rem] w-full max-w-md overflow-hidden shadow-2xl animate-in">
                                <div className="bg-[#00796b] p-6 text-white flex justify-between items-center">
                                    <span className="font-black uppercase tracking-widest flex items-center gap-2">API Configuration</span>
                                    <button onClick={() => setShowSettings(false)} className="hover:bg-white/10 p-1 rounded-lg"><Icon name="X" /></button>
                                </div>
                                <div className="p-8">
                                    <label className="text-[10px] font-black text-slate-400 uppercase mb-2 block">Gemini API Key</label>
                                    <input 
                                        type="password" 
                                        value={apiKey} 
                                        onChange={e => setApiKey(e.target.value)} 
                                        className="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl mb-6 font-mono text-sm outline-none focus:border-[#00796b] focus:bg-white transition-all shadow-inner" 
                                        placeholder="Paste Gemini Key here..." 
                                    />
                                    <button onClick={() => setShowSettings(false)} className="w-full bg-[#00796b] hover:bg-[#00695c] text-white py-4 rounded-xl font-black uppercase tracking-widest text-xs transition-all shadow-lg active:scale-95">Save & Initialize</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
